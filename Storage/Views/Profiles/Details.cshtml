@model Storage.Models.Profile
@using Microsoft.AspNet.Identity

@{
    ViewBag.Title = "Details";
}

<h2>Details</h2>

<div>
    <h4>Profile</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Name)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Email)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Email)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.GroupId)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Group.Group)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Tehnology)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Tehnology)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.DateStartWork)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.DateStartWork)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.DateEndWork)
        </dt>

        <dd>
            @if (Model.DateEndWork == null)
            {
                @: -
            }
            else
            {
                @Html.DisplayFor(model => model.DateEndWork)
            }
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Equipments)
        </dt>

        <dd class="equipments">
            @foreach (var equipment in Model.Equipments)
            {
                <ul class="equipment-@equipment.Id">
                    <li>
                        @equipment.CategorieId @equipment.Name @equipment.Key
                        @if (User.IsInRole("Admin"))
                        {
                            <input id="@equipment.Id" type="button" value="X" class="remove">
                        }
                    </li>
                </ul>
            }
        </dd>

    </dl>
</div>
<p>
    @if (User.IsInRole("Admin"))
    {
        @Html.ActionLink("Edit", "Edit", new { id = Model.Id }) @:|
    }
    @Html.ActionLink("Back to List", "Index")
</p>


@section scripts{

    <script>
        $('.remove').click(function () {

            var thisElement = $(this);
            var equipments = {
                'EquipmentId': thisElement.attr("id"),
                'UserId': "@Model.UserId"
            };
            $.ajax({
                url: "@(Url.Action("RemoveFromProfile", "EquipmentManage"))",
                type: "Post",
                data: JSON.stringify(equipments),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: successFunc,
                error: errorFunc
            });
        });


        function successFunc(data, status) {
            $('.equipment-'+ data).remove();
            alert("Предмет повернено на склад");
        }

        function errorFunc(errorData) {
            alert('Ошибка' + errorData.responseText);
        }

    </script>
}